// Комплексный тест для извлечения названий моделей
// Использует общую логику из pattern-extractor

import {
  extractModelNameFromCertificate,
  clearReferenceCache,
} from './src/modules/parser/utils/pattern-extractor';

function testExtractModelNameFromCertificate(certificateName) {
  if (!certificateName) return '';

  console.log(`\nTesting: "${certificateName}"`);

  const result = extractModelNameFromCertificate(certificateName);
  if (!result) {
    return '';
  }

  if (result.matched && result.normalizedName) {
    console.log(
      `✅ Matched with pattern "${result.patternName}": "${result.normalizedName}"`,
    );
    return result.normalizedName;
  } else {
    console.log(`❌ No pattern matched`);
    return '';
  }
}

// Тестовые случаи
const testCases = [
  {
    input:
      'Система ультразвуковая диагностическая EPIQ с принадлежностями варианты исполнения:  EPIQ I. Система ультразвуковая диагностическая EPIQ в варианте исполнения EPIQ, РЗН 2014/2234',
    expected: 'EPIQ',
  },
  {
    input:
      'Аппарат ультразвуковой диагностический многофункциональный MyLab, вариант исполнения: MyLab Omega с принадлежностями',
    expected: 'MyLab Omega',
  },
  {
    input:
      'Система ультразвуковая диагностическая EPIQ Elite с принадлежностями',
    expected: 'EPIQ Elite',
  },
  {
    input: 'MyLab X8 eXP с принадлежностями',
    expected: 'MyLab X8 eXP',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская Vivid iq с принадлежностями, вариант исполнения: Система ультразвуковая диагностическая медицинская  Vivid iq Premium console, производства ДжиИ Медикал Системз (Китай) Ко., Лтд., Китай (РЗН 2017/6506)',
    expected: 'Vivid iq Premium console',
  },
  {
    input:
      'РЗН 2020/13006 Система ультразвуковая диагностическая медицинская «РуСкан 70П» по ТУ 26.60.12-004-98204792-2020 с принадлежностями',
    expected: 'РуСкан 70П',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская Vivid iq Premium console',
    expected: 'Vivid iq Premium console',
  },
  {
    input:
      'РЗН 2020/13006 Система ультразвуковая диагностическая медицинская "РуСкан 70П" по ТУ 26.60.12-004-98204792-2020 с принадлежностямиБазовый состав:1.Электронная консоль в составе с функциональными модулями управления, монитором, панелью управления, пластиковым корпусом, производства фирмы АО «НПО «СКАНЕР», Россия, или производства фирмы SAMSUNG MEDISON CO.LTD., Республика Корея - 1 шт.2.Программное обеспечение для управления ультразвуковым сканером, посредством русскоязычного интерфейса «РуСкан 70П версия 3.00.08», производства фирмы ЗАО "Медиэйс", Россия. - 1 шт.',
    expected: 'РуСкан 70П',
  },
  {
    input:
      'Система ультразвуковая диагностическая, вариант исполнения V7-RUS, производитель «САМСУНГ МЕДИСОН КО., ЛТД.» , Республика Корея. Ультразвуковой диагностический аппарат HM70A-RUS с принадлежностями. Производитель: «Самсунг Медисон КО.,ЛТД» Республика Корея, Samsung Medison Co., LTD., 3366, Hanseo-ro, Nam-myeon, Hongcheon-gun, Gangwon-do, 25108,Republic of Korea. Страна происхождения товара Республика Корея',
    expected: 'HM70A-RUS',
  },
  {
    input:
      'Система ультразвуковая диагностическая Aloka Arietta 850 с принадлежностями, производитель «ФУДЖИФИЛЬМ Хелскеа Корпорэйшн», Япония',
    expected: 'Aloka Arietta 850',
  },
  {
    input:
      'Система ультразвуковая диагностическая, вариант исполнения V7-RUS, производитель «САМСУНГ МЕДИСОН КО., ЛТД.» , Республика Корея',
    expected: 'V7-RUS',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская с Logiq E10 c принадлежностями',
    expected: 'LOGIQ E10',
  },
  {
    input: 'Система ультразвуковая цифровая цветовая доплеровская CHISON',
    expected: 'CHISON',
  },
  {
    input:
      'РЗН 2021/15918, I Сканер ультразвуковой диагностический "СмартСкан" ("SmartScan") по ТУ 26.60.12-001-56312059-2019варианты исполнения: IСканер ультразвуковой диагностический "СмартСкан 15А", исполнение 00',
    expected: 'СмартСкан 15А',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская Venue Go с принадлежностями, производства "ДжиИ Медикал Системз Ультрасаунд и Праймери Кэа Диагностик, ЛЛС", Соединенные Штаты Америки (РЗН 2021/15705)',
    expected: 'Venue Go',
  },
  {
    input:
      'Система ультразвуковая диагностическая W9-RUS с принадлежностями, производитель "САМСУНГ МЕДИСОН КО., ЛТД.", Республика Корея (РЗН 2022/17720)',
    expected: 'W9-RUS',
  },
  {
    input:
      'Система ультразвуковой визуализации универсальная серии EM7 с принадлежностями по ТУ 26.60.12-003-39346393-2021, в составе: Система ультразвуковой визуализации универсальная серии ЕМ7 с принадлежностями, вариант исполнения: ЕМ7 Ехр по ТУ 26.60.12-003-39346393-2021',
    expected: 'EM7',
  },
  {
    input:
      'Система ультразвуковой визуализации универсальная серии ЕМ7 с принадлежностями по ТУ 26.60.12-003-39346393-2021, в составе: Система ультразвуковой визуализации универсальная серии ЕМ7 с принадлежностями, вариант исполнения: ЕМ7 Ехр по ТУ 26.60.12-003-39346393-2021',
    expected: 'EM7',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская "РуСкан 65" по ТУ 26.60.12-003-98204792-2019 с принадлежностями',
    expected: 'РуСкан 65',
  },
  {
    input: 'Система ультразвуковая цифровая цветовая доплеровская CHISON',
    expected: 'CHISON',
  },
  {
    input:
      'Система ультразвуковая диагностическая, вариант исполнения V7-RUS, "САМСУНГ МЕДИСОН КО., ЛТД."',
    expected: 'V7-RUS',
  },
  {
    input:
      'Система ультразвуковой визуализации универсальная серии ЕМ7, вариант исполнения: ЕM7Exp с принадлежностями по ТУ 26.60.12-003-39346393-2021',
    expected: 'EM7',
  },
  {
    input:
      'Система диагностическая ультразвуковая Acclarix с принадлежностями,  вариант исполнения: Система диагностическая ультразвуковая U60',
    expected: 'U60',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская Vivid iq с принадлежностями вариант исполнения: 1.2. Система ультразвуковая диагностическая медицинская Vivid iq Premium console',
    expected: 'Vivid iq Premium console',
  },
  {
    input:
      'Система ультразвуковая диагностическая Affiniti с принадлежностями, в варианте исполнения: Affiniti 70"Филипс Ультрасаунд, ЛЛС."',
    expected: 'Affiniti 70',
  },
  {
    input:
      'Аппарат ультразвуковой диагностический серии М с принадлежностями, варианты исполнения: М9 Производитель: "Шэньчжэнь Майндрэй Био-Мeдикал Электроникс Ко., Лтд.", Shenzhen Mindray Bio-Medical Electronics Co., Ltd. Страна происхождения: Китайская Народная Республика',
    expected: 'M9',
  },
  {
    input:
      'РУ № РЗН 2024/23835 от 30.10.2024 г.: IV. Система ультразвуковой визуализации универсальная серии Consona N7 с принадлежностями, вариант исполнения: Consona N7Q по ТУ 26.60.12-001- 51850757 -2024',
    expected: 'Consona N7Q',
  },
  {
    input:
      'истема ультразвуковой визуализации универсальная серии Consona N7 с принадлежностями, вариант исполнения: Система ультразвуковой визуализации универсальная серии Consona N7 с принадлежностями, вариант исполнения Consona N7 Exp',
    expected: 'Consona N7 Exp',
  },
  {
    input:
      'Система ультразвуковой визуализации универсальная серии Consona N7 с принадлежностями,',
    expected: 'Consona N7',
  },
  {
    input:
      'Система ультразвуковая диагностическая медицинская Vivid с принадлежностями, в исполнении Vivid Е95',
    expected: 'Vivid E95',
  },
  {
    input:
      'Система ультразвуковая диагностическая, вариант исполнения V6- RUS; РЗН 2023/21213',
    expected: 'V6-RUS',
  },
  {
    input: 'Система ультразвуковая диагностическая W10-RUS с принадлежностями',
    expected: 'W10-RUS',
  },
  {
    input: 'Система диагностическая ультразвуковая HS40-RUS с принадлежностями',
    expected: 'HS40-RUS',
  },
];

console.log('=== КОМПЛЕКСНЫЙ ТЕСТ ИЗВЛЕЧЕНИЯ НАЗВАНИЙ МОДЕЛЕЙ ===\n');

testCases.forEach((testCase, index) => {
  console.log(`\n--- Тест ${index + 1} ---`);
  console.log(`Ожидается: "${testCase.expected}"`);

  const result = testExtractModelNameFromCertificate(testCase.input);
  console.log(`Результат: "${result}"`);
  console.log(
    `Статус: ${result === testCase.expected ? '✅ УСПЕХ' : '❌ ОШИБКА'}`,
  );
});
